var Re=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Fe=(t,a,s)=>a in t?Re(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,L=(t,a)=>{for(var s in a||(a={}))Se.call(a,s)&&Fe(t,s,a[s]);if(be)for(var s of be(a))Ne.call(a,s)&&Fe(t,s,a[s]);return t};var x=(t,a,s)=>new Promise((r,A)=>{var l=c=>{try{w(s.next(c))}catch(h){A(h)}},p=c=>{try{w(s.throw(c))}catch(h){A(h)}},w=c=>c.done?r(c.value):Promise.resolve(c.value).then(l,p);w((s=s.apply(t,a)).next())});import{u as n,g as Ce,c as X,w as Q,am as Ue,x as Ae,H as we,h as We,d as ke,J as He,r as Ve,f as J,o as Ke,Z as ue,a8 as Ie,a9 as re,l as Te,N as ie,_ as Ye,aa as de,ad as Be,ai as pe,aj as he,F as Xe,ac as Ee,ak as qe}from"./vue-f962b0e4.js";import{_ as ze}from"./FormItem.vue_vue_type_script_lang-7b2813c2.js";import{b as Ge,c as Je,_ as Qe}from"./BasicForm.vue_vue_type_style_index_0_lang-9667d3a7.js";import{h as Ze,i as ae,d as _e,a as Me}from"./helper-b0407d84.js";import{O as et,Q as K,R as Z,n as le,p as ce,S as q,U as M,V as De,W,c as z,N as tt,u as je,X as Oe,Y as me,d as Le,h as nt}from"./index.js";import{g as ye}from"./get-3d19de2f.js";import{i as st}from"./isNumber-f0336cfd.js";import{i as ot}from"./isBoolean-9388e2d6.js";import{u as rt}from"./uniqBy-3d1a97d8.js";import{u as it}from"./index-05c55ef7.js";import{R as at,y as ct}from"./antd-2f1e67c0.js";function xe(t,a){return t==null?!0:et(t,a)}function lt(t,a,s){const r=/^\[(.+)\]$/;if(r.test(t)){const A=t.match(r);if(A&&A[1]){const l=A[1].split(",");return a=Array.isArray(a)?a:[a],l.forEach((p,w)=>{q(s,p.trim(),a[w])}),!0}}}function ft(t,a,s){const r=/^\{(.+)\}$/;if(r.test(t)){const A=t.match(r);if(A&&A[1]){const l=A[1].split(",");return a=K(a)?a:{},l.forEach(p=>{q(s,p.trim(),a[p.trim()])}),!0}}}function ut({defaultValueRef:t,getSchema:a,formModel:s,getProps:r}){function A(c){var F,E;if(!K(c))return{};const h={};for(const T of Object.entries(c)){let[,u]=T;const[d]=T;if(!d||Z(u)&&u.length===0||le(u))continue;const D=n(r).transformDateFunc;K(u)&&(u=D==null?void 0:D(u)),Z(u)&&((F=u[0])!=null&&F.format)&&((E=u[1])!=null&&E.format)&&(u=u.map(y=>D==null?void 0:D(y))),ce(u)&&(u===""?u=void 0:u=u.trim()),!lt(d,u,h)&&!ft(d,u,h)&&q(h,d,u)}return l(h)}function l(c){const h=n(r).fieldMapToTime;if(!h||!Array.isArray(h))return c;for(const[F,[E,T],u="YYYY-MM-DD"]of h){if(!F||!E||!T)continue;if(!ye(c,F)){xe(c,F);continue}const[d,D]=ye(c,F),[y,b]=Array.isArray(u)?u:[u,u];!M(d)&&!De(d)&&q(c,E,p(d,y)),!M(D)&&!De(D)&&q(c,T,p(D,b)),xe(c,F)}return c}function p(c,h){return h==="timestamp"?W(c).unix():h==="timestampStartDay"?W(c).startOf("day").unix():W(c).format(h)}function w(){const c=n(a),h={};c.forEach(F=>{const{defaultValue:E,defaultValueObj:T}=F,u=Object.keys(T||{});u.length&&u.map(d=>{h[d]=T[d],s[d]===void 0&&(s[d]=T[d])}),M(E)||(h[F.field]=E,s[F.field]===void 0&&(s[F.field]=E))}),t.value=z(h)}return{handleFormValues:A,initDefault:w}}const Y=24;function dt({advanceState:t,emit:a,getProps:s,getSchema:r,formModel:A,defaultValueRef:l}){const p=Ce(),{realWidthRef:w,screenEnum:c,screenRef:h}=tt(),F=X(()=>{if(!t.isAdvanced)return 0;const y=n(s).emptySpan||0;if(st(y))return y;if(K(y)){const{span:b=0}=y,_=n(h);return y[_.toLowerCase()]||b||0}return 0}),E=je(d,30);Q([()=>n(r),()=>t.isAdvanced,()=>n(w)],()=>{const{showAdvancedButton:y}=n(s);y&&E()},{immediate:!0});function T(y,b=0,_=!1){const P=n(w),C=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||Y,$=parseInt(y.lg)||C,N=parseInt(y.xl)||$,R=parseInt(y.xxl)||N;return P<=c.LG?b+=C:P<c.XL?b+=$:P<c.XXL?b+=N:b+=R,_?(t.hideAdvanceBtn=!1,b<=Y*2?(t.hideAdvanceBtn=!0,t.isAdvanced=!0):b>Y*2&&b<=Y*(n(s).autoAdvancedLine||3)?t.hideAdvanceBtn=!1:t.isLoad||(t.isLoad=!0,t.isAdvanced=!t.isAdvanced),{isAdvanced:t.isAdvanced,itemColSum:b}):b>Y*(n(s).alwaysShowLines||1)?{isAdvanced:t.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const u=Ue({});function d(){var P;let y=0,b=0;const{baseColProps:_={}}=n(s);for(const C of n(r)){const{show:$,colProps:N}=C;let R=!0;if(ot($)&&(R=$),le($)&&(R=$({schema:C,model:A,field:C.field,values:L(L({},n(l)),A)})),R&&(N||_)){const{itemColSum:k,isAdvanced:G}=T(L(L({},_),N),y);y=k||0,G&&(b=y),u[C.field]=G}}(P=p==null?void 0:p.proxy)==null||P.$forceUpdate(),t.actionSpan=b%Y+n(F),T(n(s).actionColOptions||{span:Y},y,!0),a("advanced-change")}function D(){t.isAdvanced=!t.isAdvanced}return{handleToggleAdvanced:D,fieldsIsAdvancedMap:u}}function pt(t,a={}){const s=/^\[(.+)\]$/;if(s.test(t)){const r=t.match(s);if(r&&r[1]){const A=r[1].split(",");if(!A.length)return;const l=[];return A.forEach((p,w)=>{q(l,w,a[p.trim()])}),l.filter(Boolean).length?l:void 0}}}function ht(t,a={}){const s=/^\{(.+)\}$/;if(s.test(t)){const r=t.match(s);if(r&&r[1]){const A=r[1].split(",");if(!A.length)return;const l={};return A.forEach(p=>{q(l,p.trim(),a[p.trim()])}),Object.values(l).filter(Boolean).length?l:void 0}}}function mt({emit:t,getProps:a,formModel:s,getSchema:r,defaultValueRef:A,formElRef:l,schemaRef:p,handleFormValues:w}){function c(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:o}=n(a);e&&le(e)&&(yield e()),n(l)&&(Object.keys(s).forEach(i=>{const m=n(r).find(O=>O.field===i),g=m==null?void 0:m.defaultValueObj,B=Object.keys(g||{});B.length&&B.map(O=>{s[O]=g[O]}),s[i]=yt(m,A,i)}),Ae(()=>N()),t("reset",we(s)),o&&k())})}const h=()=>n(r).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function F(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const o=h(),v=".",i=o.filter(g=>String(g).indexOf(v)>=0),m=[];o.forEach(g=>{const B=n(r).find(I=>I.field===g);let O=ye(e,g);const fe=Reflect.has(e,g);O=Ze(B==null?void 0:B.component,O);const{componentProps:ee}=B||{};let S=ee;typeof ee=="function"&&(S=S({formModel:n(s),formActionType:G}));const te=pt(g,e)||ht(g,e);if(fe||te){const I=te||O;if(_(g))if(Array.isArray(I)){const H=[];for(const f of I)H.push(f?W(f):null);n(s)[g]=H}else n(s)[g]=I?S!=null&&S.valueFormat?I:W(I):null;else n(s)[g]=I;S!=null&&S.onChange&&(S==null||S.onChange(I)),m.push(g)}else i.forEach(I=>{try{const H=I.split(".").reduce((f,j)=>f[j],e);Oe(H)&&(n(s)[I]=n(H),m.push(I))}catch(H){Oe(A.value[I])&&(n(s)[I]=z(n(A.value[I])))}})}),P(m).catch(g=>{})})}function E(e){return x(this,null,function*(){const o=z(n(r));if(!e)return;let v=ce(e)?[e]:e;ce(e)&&(v=[e]);for(const i of v)T(i,o);p.value=o})}function T(e,o){if(ce(e)){const v=o.findIndex(i=>i.field===e);v!==-1&&(delete s[e],o.splice(v,1))}}function u(e,o,v=!1){return x(this,null,function*(){const i=z(n(r)),m=Array.isArray(e)?e.map(O=>O.field):[e.field];if(i.find(O=>m.includes(O.field))){me("There are schemas that have already been added");return}const g=i.findIndex(O=>O.field===o),B=K(e)?[e]:e;!o||g===-1||v?v?i.unshift(...B):i.push(...B):g!==-1&&i.splice(g+1,0,...B),p.value=i,y(e)})}function d(e){return x(this,null,function*(){let o=[];if(K(e)&&o.push(e),Z(e)&&(o=[...e]),!o.every(i=>ae(i.component)||Reflect.has(i,"field")&&i.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}p.value=o})}function D(e){return x(this,null,function*(){let o=[];if(K(e)&&o.push(e),Z(e)&&(o=[...e]),!o.every(m=>ae(m.component)||Reflect.has(m,"field")&&m.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(r).forEach(m=>{let g;if(o.forEach(B=>{m.field===B.field&&(g=B)}),g!==void 0&&m.field===g.field){const B=Le(m,g);i.push(B)}else i.push(m)}),y(i),p.value=rt(i,"field")})}function y(e){let o=[];K(e)&&o.push(e),Z(e)&&(o=[...e]);const v={},i=b();o.forEach(m=>{!ae(m.component)&&Reflect.has(m,"field")&&m.field&&!M(m.defaultValue)&&(!(m.field in i)||M(i[m.field]))&&(v[m.field]=m.defaultValue)}),F(v)}function b(){return n(l)?w(we(n(s))):{}}function _(e){return n(r).some(o=>o.field===e&&o.component?_e.includes(o.component):!1)}function P(e){return x(this,null,function*(){var v;const o=yield(v=n(l))==null?void 0:v.validateFields(e);return w(o)})}function C(e){return x(this,null,function*(){var o;yield(o=n(l))==null?void 0:o.setProps(e)})}function $(e){return x(this,null,function*(){var i;let o;e===void 0?o=h():o=e===Array.isArray(e)?e:void 0;const v=yield(i=n(l))==null?void 0:i.validate(o);return w(v)})}function N(e){return x(this,null,function*(){var o;yield(o=n(l))==null?void 0:o.clearValidate(e)})}function R(e,o){return x(this,null,function*(){var v;yield(v=n(l))==null?void 0:v.scrollToField(e,o)})}function k(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:o}=n(a);if(o&&le(o)){yield o();return}if(n(l))try{const i=yield $();t("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const G={getFieldsValue:b,setFieldsValue:F,resetFields:c,updateSchema:D,resetSchema:d,setProps:C,removeSchemaByField:E,appendSchemaByField:u,clearValidate:N,validateFields:P,validate:$,submit:k,scrollToField:R};return{handleSubmit:k,clearValidate:N,validate:$,validateFields:P,getFieldsValue:b,updateSchema:D,resetSchema:d,appendSchemaByField:u,removeSchemaByField:E,resetFields:c,setFieldsValue:F,scrollToField:R}}function yt(t,a,s){let r=z(a.value[s]);return vt(t)?r||"":(!r&&t&&At(t)&&(r=[0,0]),!r&&t&&t.component==="ApiTree"&&(r=[]),r)}function At(t){if(t.component==="Slider"&&t.componentProps&&"range"in t.componentProps)return!0}function vt(t){return(t==null?void 0:t.component)&&Me.includes(t.component)}function gt(A){return x(this,arguments,function*({getSchema:t,getProps:a,formElRef:s,isInitedDefault:r}){We(()=>x(this,null,function*(){if(n(r)||!n(a).autoFocusFirstItem)return;yield Ae();const l=n(t),p=n(s),w=p==null?void 0:p.$el;if(!p||!w||!l||l.length===0)return;const c=l[0];if(!c.component||!c.component.includes("Input"))return;const h=w.querySelector(".ant-row:first-child input");h&&(h==null||h.focus())}))})}const jt=ke({name:"BasicForm",__name:"BasicForm",props:Ge,emits:["advanced-change","reset","submit","register","field-value-change"],setup(t,{expose:a,emit:s}){const r=t,A=He(),l=Ve({}),p=it(),w=Ve({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=J({}),h=J(!1),F=J(),E=J(null),T=J(null),{prefixCls:u}=nt("basic-form"),d=X(()=>L(L({},r),n(F))),D=X(()=>[u,{[`${u}--compact`]:n(d).compact}]),y=X(()=>{const{baseRowStyle:f={},rowProps:j}=n(d);return L({style:f},j)}),b=X(()=>L(L(L({},A),r),n(d))),_=X(()=>{var j;const f=n(E)||n(d).schemas;for(const V of f){const{defaultValue:U,component:ne,componentProps:se={},isHandleDateDefaultValue:Pe=!0}=V;if(Pe&&U&&ne&&_e.includes(ne)){const $e={schema:V,tableAction:(j=r.tableAction)!=null?j:{},formModel:l,formActionType:{}},oe=se?typeof se=="function"?se($e).valueFormat:se.valueFormat:null;if(!Array.isArray(U))V.defaultValue=oe?W(U).format(oe):W(U);else{const ve=[];U.forEach(ge=>{ve.push(oe?W(ge).format(oe):W(ge))}),V.defaultValue=ve}}}return n(d).showAdvancedButton?z(f.filter(V=>!ae(V.component))):z(f)}),{handleToggleAdvanced:P,fieldsIsAdvancedMap:C}=dt({advanceState:w,emit:s,getProps:d,getSchema:_,formModel:l,defaultValueRef:c}),{handleFormValues:$,initDefault:N}=ut({getProps:d,defaultValueRef:c,getSchema:_,formModel:l});gt({getSchema:_,getProps:d,isInitedDefault:h,formElRef:T});const{handleSubmit:R,setFieldsValue:k,clearValidate:G,validate:e,validateFields:o,getFieldsValue:v,updateSchema:i,resetSchema:m,appendSchemaByField:g,removeSchemaByField:B,resetFields:O,scrollToField:fe}=mt({emit:s,getProps:d,formModel:l,getSchema:_,defaultValueRef:c,formElRef:T,schemaRef:E,handleFormValues:$});Je({resetAction:O,submitAction:R}),Q(()=>n(d).model,()=>{const{model:f}=n(d);f&&k(f)},{immediate:!0}),Q(()=>r.schemas,f=>{m(f!=null?f:[])}),Q(()=>_.value,f=>{Ae(()=>{var j;(j=p==null?void 0:p.redoModalHeight)==null||j.call(p)}),!n(h)&&f!=null&&f.length&&(N(),h.value=!0)}),Q(()=>l,je(()=>{n(d).submitOnChange&&R()},300),{deep:!0});function ee(f){return x(this,null,function*(){F.value=Le(n(F)||{},f)})}function S(f,j,V){l[f]=j,s("field-value-change",f,j),V&&V.itemProps&&!V.itemProps.autoLink&&o([f]).catch(U=>{})}function te(f){const{autoSubmitOnEnter:j}=n(d);if(j&&f.key==="Enter"&&f.target&&f.target instanceof HTMLElement){const V=f.target;V&&V.tagName&&V.tagName.toUpperCase()=="INPUT"&&R()}}const I={getFieldsValue:v,setFieldsValue:k,resetFields:O,updateSchema:i,resetSchema:m,setProps:ee,removeSchemaByField:B,appendSchemaByField:g,clearValidate:G,validateFields:o,validate:e,submit:R,scrollToField:fe},H=X(()=>L(L({},d.value),w));return a(L({},I)),Ke(()=>{N(),s("register",I)}),(f,j)=>(ue(),Ie(n(ct),Ee(b.value,{class:D.value,ref_key:"formElRef",ref:T,model:l,onKeypress:qe(te,["enter"])}),{default:re(()=>[Te(n(at),pe(he(y.value)),{default:re(()=>[ie(f.$slots,"formHeader"),(ue(!0),Ye(Xe,null,de(_.value,V=>(ue(),Ie(ze,{key:V.field,isAdvanced:n(C)[V.field],tableAction:f.tableAction,formActionType:I,schema:V,formProps:d.value,allDefaultValues:c.value,formModel:l,setFormModel:S},Be({_:2},[de(Object.keys(f.$slots),U=>({name:U,fn:re(ne=>[ie(f.$slots,U,pe(he(ne||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(Qe,Ee(H.value,{onToggleAdvanced:n(P)}),Be({_:2},[de(["resetBefore","submitBefore","advanceBefore","advanceAfter"],V=>({name:V,fn:re(U=>[ie(f.$slots,V,pe(he(U||{})))])}))]),1040,["onToggleAdvanced"]),ie(f.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"]))}});export{jt as _};
